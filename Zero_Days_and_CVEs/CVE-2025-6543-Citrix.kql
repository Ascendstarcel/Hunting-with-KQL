// Detection query for CVE-2025-6543 Citrix NetScaler zero-day exploitation
DeviceProcessEvents
| where TimeGenerated > ago(30d)
| where InitiatingProcessFileName has_any ("nsconmsg.exe", "nstcpdump.exe", "nscli.exe", "netscaler.exe")
| where ProcessCommandLine has_any ("-exploit", "-payload", "-cmd", "recv", "exec", "shell")
| extend CVE = "CVE-2025-6543"
| project TimeGenerated, DeviceName, InitiatingProcessFileName, ProcessCommandLine, CVE
| order by TimeGenerated desc

// Additionally, suspicious network connections on ports commonly targeted by NetScaler exploits (e.g., 80, 443, 8443)
union (
    NetworkCommunicationEvents
    | where TimeGenerated > ago(30d)
    | where RemotePort in (80, 443, 8443)
    | where InitiatingProcessFileName has_any ("nsconmsg.exe", "nstcpdump.exe", "nscli.exe", "netscaler.exe")
    | extend CVE = "CVE-2025-6543"
    | project TimeGenerated, DeviceName, RemoteIP, RemotePort, InitiatingProcessFileName, CVE
)
| order by TimeGenerated desc
